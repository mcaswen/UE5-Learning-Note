##  技能机制
#### 1. **传送门**
	- 所有移动单位传送
	- 所有检测机制传送
	- 特效分段切割
	- 模型切割赋值

	1. 角色过门，提前复制模型，相机独立过门；
	2. 子弹过门，基于相机虚拟点，确定发射方向；
	3. 检测过门，在检测管线底层对检测路径线段化。

#### 2. **重力陨石**
	- 吸收所有飞行弹道（实体）
	- 吸收所有瞬时弹道（非实体）

	1. 陨石范围实际上是一个大碰撞检测范围。
	2. 检测过门，在检测管线底层对检测路径线段化。

#### 3. **盾牌反击**
	- 吸收所有飞行弹道（实体）
	- 吸收所有瞬时弹道（非实体）
	- 阵营变更

	1. 被命中，检测管线对检测路径线段化
	2. 根据检测上下文修改子弹来源
	3. 重新计算子弹飞行数据（碰撞，速度，方向等）
## GAS 框架
#### **特征：**
1. **`Ability`** 技能逻辑体
	激活，冷却，消耗等

2. **`Task`** 技能行为
	检测，动画，位移

3. **`Effect`** 生效效果
	属性修改，抑制关系

4. **`Cue`** 视听表现
	特效，材质，音效，UX

#### **技能数据配置：**
1. **`AbilityAsset`** 
	技能基础性框架配置，涉及UI，输入，镜头等公共配置。
	ex: `Combo, Timeline, Input, Enhanced Input, Gameplay Cue.`

2. **`AbilityConfig`** 
	以 `InlineStruct` 内联 `AbilityAsset` 内用于各个技能特殊的技能配置。
	ex: 法术场id, 法术场爆炸次数，法术场步进距离，法术场攀升最高高度...

3. **`AbilityBP`** 
	技能关系，技能状态，类型标识等逻辑配置。
	ex: `Tick, Tags, Input, Triggers, Cooldowns, Disconnect.`

#### **`Timeline`：**
	描述了技能逻辑执行的状态过程。
- `Timeline` 负责组织技能的过程，描述技能的各个阶段以及行为。
- `Montage` 负责执行技能动作，与 `Timeline` 解耦分别执行。

#### **`Buff`系统：**
- 构建实例，模板，状态三重结构。
- 实例跟随技能不断扩充，模板统一战斗内共性的效果，而状态维持战斗中最细颗粒度的行为。
1. **`Buff`** 
	配置生命周期，叠层，周期，脚本等，覆写 `Effect` 模板配置。
	- 每个技能独立
	- 引用 `Effect`

2. **`Effect`**
	效果模板：增益/减益类型，修改属性方式，阻塞/驱散关系等。
	- 英雄共性效果
	- 引用 `Status`

3. **`Status`**
	底层细粒度状态控制：不可移动，不能跳跃，控制不同状态类型状态等。
	- 最细颗粒度行为
	- 引用 `GameplayTag`

#### 特效表现 **`GameplayCue/CueData`**
	表现涉及广泛：特效、材质、模型、镜头、音频、`UX` 等等，且每个技能表现有很大差异，通过构建中间层标准化行为修改表现效果。
	
1. **`GameplayCue`** 
	- 表现载体（方位、`Gameplay` 上下层级关系）
	- 技能相关表现数据

2. **`CueDataProxy`**
	- 特效激活、结束曲线控制参数修改
	- 控制位置更新，材质隐藏

3. **`Display`**
	- `Niagara`
	- `SkeletaMesh`

#### 示例：

| 功能                      | Proxy                     | 说明                      | 使用场景     |
| ----------------------- | ------------------------- | ----------------------- | -------- |
| `CueData`: `Float曲线`    | `CueUserData_FloatCurve`  | 根据 `Float曲线` 设置材质、特效的参数 | 淡入淡出     |
| `CueData`: 挂载到角色        | `CueUserData_Attach`      | `Attach` 当前组件到角色某骨骼点上   | 黑寡妇卸下狙击枪 |
| `DataInterface`: 属性     | `DataInterface_Attribute` | 针对角色属性做针对性的表现           | 低血量表现    |
| `DataInterface`: `Buff` | `DataInterface_Buff`      | 获取角色状态，做通用的 `Buff` 表现   | 霸体、眩晕    |

#### 衍生物
	战斗所需的除角色外载体
	
1. **召唤物 `SummonedComponent`** 
	- 生命值、可拥有能力 `ASC` 等

2. **投射物 `CueDataProxy`**
	- 飞行、速度、弹道、追踪 等

3. **射线检测 `TraceComponent`**
	- 检测规则、检测目标

#### 检测管线
	- 新规则的加入，需要尽可能不影响原有的检测配置
	- 结合全局、来源、目标、规则、构建分层管线结构
	
##### 工作流程
1. 收集来源上下文信息和状态快照
2. 结合检测规则，全局规则，确定 `Response`、`Musk`
3. 收集目标状态快照，以及可重写的条件
4. 针对目标做进一步的筛选（距离、角度、遮挡等等）

###### 1. 检测对象
- 投射物
- 法术场
- 枪械
- ...
###### 2. 检测方法
- 玩法全局配置
- 检测类型
- 检测规则
- 目标要求
###### 3. 检测目标
- 角色
- 衍生物
- 场景
- ...



#### 预测机制 
	网络同步的核心。

##### 如何正确地预测？
	客户端虽然先行，但在服务器权威之下。必然存在先行成功或者先行失败。

- `FScopedPredictionWindow` 预测窗口
	在栈内构建预测逻辑，通过构造函数和析构函数来标定预测逻辑的生命周期。
- `FPredictionKey` 预测标识
	预测逻辑的唯一标识，由预测窗口产生和使用

###### 如何防止业务层所有函数调用的都要构建预测窗口？
	利用预测标识，仅在预测失败时重新构建窗口即可。

##### 可预测的行为
###### 预测
	- 激活、结束等流程步骤
	- 冲刺、位移等客户端输入行为
	- 衍生物等独立实体
	- 能量、弹药等主端小号
	- 动画、特效、UI 等纯表现行为

###### 不预测
	- Buff 对目标单位的效果
	- 伤害、血量等属性修改
	- 技能关键状态切换逻辑

##### 可回滚的行为
###### 可回滚
	- 激活、结束等流程步骤
	- 冲刺、位移等客户端输入行为（拉回）
	- 法术场、召唤物等独立实体（销毁）
	- 能量、弹药等主端消耗（重置）

###### 不回滚
	- 动画、特效、UI 等纯表现行为
	- 投射物、瞬时弹道（一次性）