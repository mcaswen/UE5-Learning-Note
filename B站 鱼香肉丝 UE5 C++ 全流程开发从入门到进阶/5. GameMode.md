### GameMode 的核心概念

​**​GameMode​**​ 类（`AGameModeBase`或 `AGameMode`）定义了游戏的规则。它只存在于服务器端，客户端无法访问或同步。这意味着所有核心游戏规则的判断和决策都必须在服务器上进行，以保证多人游戏的公平性和一致性。

它的核心职责可以概括为：​**​管理游戏规则，生成玩家，并维护游戏的整体状态。​**​

---

### 主要职责与功能

#### 1. 游戏规则（Game Rules）

- ​**​定义游戏状态​**​：游戏是正在进行、已暂停还是已结束？GameMode 决定了游戏的整体流程。
    
- ​**​胜负条件​**​：判断玩家或团队何时获胜/失败（例如，歼灭所有敌人、夺取旗帜、生存到最后）。
    
- ​**​得分管理​**​：管理得分逻辑，并在条件满足时触发得分事件。
    

#### 2. 控制玩家生成（Player Spawning）

- ​**​生成玩家控制器（`PlayerControllerClass`）​**​：当新玩家加入游戏时，`GameMode` 负责生成一个 `PlayerController`实例并将其与玩家连接，用于控制角色移动。
    
- ​**​默认玩家角色类 （`DefaultPawnClass`）​**​：为每个玩家生成并分配一个默认的 `Pawn`（角色化身），例如一个角色、一辆坦克或一架飞机，可以通过重写 `DefaultPawnClass`属性来设置，且可以被`Controller`控制。
    
- ​**​使用玩家重生（`Respawn`）​**​：管理玩家死亡后的重生逻辑，包括重生延迟、重生地点选择（通过 `PlayerStart`点）等。
    

#### 3. 指定其他核心类（Default Classes）

GameMode 就像一个“蓝图工厂”，它告诉引擎在游戏过程中应该使用哪些特定的类。我们可以在蓝图中或 C++ 构造函数中设置这些默认类：

- ​**​Default Pawn Class​**​：默认的玩家角色。
    
- ​**​Player Controller Class​**​：默认的玩家/AI控制器，是非物理`Actor`，可以拥有`Pawn`或者`Pawn`的派生类。
    
- ​**​HUD Class​**​：默认的平视显示器（`UI`）,进行`UI`交互界面的展示。
    
- ​**​Game State Class​**​：默认的游戏状态，追踪记录游戏全局层面的属性，如已连接玩家列表，团队得分，已完成任务等，用于在网络上同步游戏数据。
    
- ​**​Player State Class​**​：默认的玩家状态，追踪玩家状态属性，如姓名，得分，在线状态等，用于在网络上同步玩家数据。

-  ​**​Spectator Class​**​：默认的第三方（观众）视角，玩家观察其他人时的视角类


#### 4. 与 GameState 的协作

- ​**​GameMode（服务器权威）​**​：是规则的“决策者”。它在服务器上运行，做出所有关键决定（如“玩家A得分了”）。
    
- ​**​GameState（同步到所有客户端）​**​：是规则的“宣布者”。GameMode 将需要同步的信息（如当前分数、剩余时间、游戏是否已开始）设置到 `AGameStateBase`对象中，然后引擎会自动将这些信息复制到所有客户端，确保所有玩家看到的游戏状态是一致的。
    

#### 5. 多人游戏（Multiplayer）的核心

由于 GameMode 仅在服务器上存在，它是实现权威服务器架构的基石。客户端只能向服务器发送请求（如“我想在这里生成”），但最终的决定权在服务器的 GameMode。

---


### GameMode, GameState, PlayerController, PlayerState 的关系

| 类                        | 存在位置              | 职责                                               | 比喻                          |
| ------------------------ | ----------------- | ------------------------------------------------ | --------------------------- |
| ​**​GameMode​**​         | ​**​仅服务器​**​      | ​**​制定规则​**​。如何开始游戏、如何得分、如何生成玩家。                 | ​**​导演​**​（只在幕后工作）          |
| ​**​GameState​**​        | 服务器和​**​所有客户端​**​ | ​**​同步规则状态​**​。当前分数、剩余时间、游戏是否正在进行。它包含所有玩家都知道的信息。 | ​**​记分牌和计时器​**​（所有人都能看到）    |
| ​**​PlayerController​**​ | 服务器和​**​所属客户端​**​ | ​**​处理玩家输入​**​，代表玩家的人类意志。                        | ​**​玩家的大脑​**​               |
| ​**​PlayerState​**​      | 服务器和​**​所有客户端​**​ | ​**​同步玩家状态​**​。玩家姓名、得分、ping值。它包含关于某个玩家的公开信息。     | ​**​球员的球衣和统计数据​**​（所有人都能看到） |

---

### 总结

- ​**​GameMode 是服务器的权威​**​：它定义了游戏的核心规则，并且只在服务器上运行。
    
- ​**​GameMode 是工厂​**​：它指定了游戏中使用的一系列默认类（Pawn, Controller 等）。
    
- ​**​GameMode 管理生命周期​**​：控制玩家的生成、重生和游戏的开始/结束。